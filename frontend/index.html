<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ç§‘å¤§å¥åº·ä»»å‹™åœ°åœ–</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .user-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .user-stat {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 1.1em;
        }

        .user-stat strong {
            font-size: 1.5em;
            display: block;
            margin-top: 5px;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 968px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .input-section {
            height: fit-content;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .points-preview {
            background: #f0f4ff;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
        }

        .points-preview h3 {
            color: #667eea;
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .points-preview p {
            color: #666;
            font-size: 0.9em;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        #map {
            width: 100%;
            height: 500px;
            border-radius: 10px;
        }

        .building-info {
            text-align: center;
        }

        .building-info strong {
            font-size: 1.2em;
            color: #667eea;
        }

        .unlocked-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            margin-top: 10px;
            font-weight: 600;
        }

        .unlocked {
            background: #d4edda;
            color: #155724;
        }

        .locked {
            background: #f8d7da;
            color: #721c24;
        }

        .challenges-grid {
            display: grid;
            gap: 15px;
        }

        .challenge-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }

        .challenge-card h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .challenge-progress {
            background: white;
            height: 10px;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }

        .challenge-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s;
        }

        .challenge-reward {
            color: #28a745;
            font-weight: 600;
            margin-top: 10px;
        }

        .team-section {
            display: grid;
            gap: 15px;
        }

        .team-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #667eea;
        }

        .team-card h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .team-members {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .member-badge {
            background: #667eea;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .team-progress {
            margin-top: 10px;
        }

        .team-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .team-stat-item {
            background: #f0f4ff;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .team-stat-item strong {
            display: block;
            color: #667eea;
            font-size: 1.5em;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 20px 30px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.success {
            border-left: 5px solid #28a745;
        }

        .notification.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ¨™é¡Œèˆ‡ä½¿ç”¨è€…è³‡è¨Š -->
        <div class="header">
            <h1>ğŸƒ å°ç§‘å¤§å¥åº·ä»»å‹™åœ°åœ–</h1>
            <p style="color: #666; font-size: 1.1em;">æ¢ç´¢æ ¡åœ’ Â· ç´¯ç©å¥åº·é»æ•¸ Â· è§£é–å»ºç¯‰ç‰©</p>
            <div class="user-info">
                <div class="user-stat">
                    <span>ç•¶å‰ä½¿ç”¨è€…</span>
                    <strong id="userName">å¥åº·é”äºº</strong>
                </div>
                <div class="user-stat">
                    <span>ç¸½é»æ•¸</span>
                    <strong id="totalPoints">0</strong>
                </div>
                <div class="user-stat">
                    <span>å·²è§£é–å»ºç¯‰</span>
                    <strong id="unlockedCount">0 / 15</strong>
                </div>
            </div>
        </div>

        <!-- ä¸»è¦å…§å®¹å€ -->
        <div class="main-grid">
            <!-- å·¦å´ï¼šæ¯æ—¥æ•¸æ“šè¼¸å…¥ -->
            <div class="input-section">
                <div class="card">
                    <h2>ğŸ“Š ä»Šæ—¥å¥åº·æ•¸æ“š</h2>
                    <form id="dailyForm">
                        <div class="form-group">
                            <label>ğŸš¶ æ­¥æ•¸</label>
                            <input type="number" id="steps" placeholder="ä¾‹å¦‚ï¼š8000" min="0" required>
                        </div>
                        <div class="form-group">
                            <label>â±ï¸ é‹å‹•æ™‚é–“ï¼ˆåˆ†é˜ï¼‰</label>
                            <input type="number" id="exercise" placeholder="ä¾‹å¦‚ï¼š30" min="0" required>
                        </div>
                        <div class="form-group">
                            <label>ğŸ’§ å–æ°´é‡ï¼ˆæ¯«å‡ï¼‰</label>
                            <input type="number" id="water" placeholder="ä¾‹å¦‚ï¼š2000" min="0" required>
                        </div>
                        
                        <div class="points-preview">
                            <h3 id="previewPoints">0</h3>
                            <p>é ä¼°ç²å¾—é»æ•¸</p>
                        </div>

                        <button type="submit" class="btn">ğŸ¯ æäº¤ä»Šæ—¥æ•¸æ“š</button>
                    </form>
                </div>
            </div>

            <!-- å³å´ï¼šåœ°åœ– -->
            <div class="card">
                <h2>ğŸ—ºï¸ å°ç§‘å¤§æ ¡åœ’æ¢ç´¢åœ°åœ–</h2>
                <div id="map"></div>
            </div>
        </div>

        <!-- æŒ‘æˆ°ä»»å‹™ -->
        <div class="card" style="margin-bottom: 20px;">
            <h2>ğŸ† æœ¬é€±å¥åº·æŒ‘æˆ°</h2>
            <div class="challenges-grid" id="challengesList"></div>
        </div>

        <!-- åœ˜éšŠåŠŸèƒ½ -->
        <div class="card">
            <h2>ğŸ‘¥ æˆ‘çš„åœ˜éšŠ</h2>
            <div class="team-section" id="teamSection"></div>
        </div>
    </div>

    <!-- é€šçŸ¥ -->
    <div class="notification" id="notification">
        <div id="notificationText"></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // ==================== è³‡æ–™è¨­å®š ====================
        const API_URL = 'http://localhost:5000'; // å¾Œç«¯ API ç¶²å€
        const userId = 1; // ç•¶å‰ä½¿ç”¨è€… ID

        // å°ç§‘å¤§å»ºç¯‰ç‰©è³‡æ–™ï¼ˆå«åº§æ¨™ï¼‰
        const buildingsData = [
            { id: 1, name: 'åœ‹éš›å¤§æ¨“', points: 50, lat: 25.0135, lng: 121.5420, description: 'åœ‹éš›äº‹å‹™ä¸­å¿ƒ' },
            { id: 2, name: 'ç ”æšå¤§æ¨“', points: 80, lat: 25.0128, lng: 121.5415, description: 'ç ”ç©¶ç”Ÿå®¿èˆ' },
            { id: 3, name: 'é«”è‚²é¤¨', points: 100, lat: 25.0140, lng: 121.5425, description: 'é‹å‹•å¥èº«å ´æ‰€' },
            { id: 4, name: 'åœ–æ›¸é¤¨', points: 120, lat: 25.0133, lng: 121.5410, description: 'å­¸ç¿’è³‡æºä¸­å¿ƒ' },
            { id: 5, name: 'ç¶œåˆç ”ç©¶å¤§æ¨“', points: 150, lat: 25.0125, lng: 121.5422, description: 'ç ”ç©¶å¯¦é©—å®¤' },
            { id: 6, name: 'IBå¤§æ¨“', points: 100, lat: 25.0138, lng: 121.5412, description: 'åœ‹éš›å¤§æ¨“å»¶ä¼¸' },
            { id: 7, name: 'TRå¤§æ¨“', points: 90, lat: 25.0130, lng: 121.5428, description: 'æ•™å­¸ç ”ç©¶å¤§æ¨“' },
            { id: 8, name: 'EEå¤§æ¨“', points: 110, lat: 25.0142, lng: 121.5418, description: 'é›»æ©Ÿç³»é¤¨' },
            { id: 9, name: 'BAå¤§æ¨“', points: 95, lat: 25.0136, lng: 121.5408, description: 'ç®¡ç†å­¸é™¢' },
            { id: 10, name: 'RBå¤§æ¨“', points: 130, lat: 25.0122, lng: 121.5430, description: 'ç ”ç™¼å¤§æ¨“' },
            { id: 11, name: 'å­¸ç”Ÿæ´»å‹•ä¸­å¿ƒ', points: 70, lat: 25.0145, lng: 121.5422, description: 'ç¤¾åœ˜æ´»å‹•ç©ºé–“' },
            { id: 12, name: 'è¨­è¨ˆé¤¨', points: 140, lat: 25.0120, lng: 121.5435, description: 'è¨­è¨ˆå­¸é™¢' },
            { id: 13, name: 'ææ–™ç§‘æŠ€é¤¨', points: 160, lat: 25.0115, lng: 121.5425, description: 'ææ–™ç ”ç©¶ä¸­å¿ƒ' },
            { id: 14, name: 'äººæ–‡ç¤¾æœƒå­¸é™¢', points: 85, lat: 25.0148, lng: 121.5415, description: 'äººç¤¾å­¸é™¢' },
            { id: 15, name: 'åœ‹éš›äº¤æµä¸­å¿ƒ', points: 75, lat: 25.0126, lng: 121.5405, description: 'äº¤æ›ç”Ÿæœå‹™' }
        ];

        // æ¯é€±æŒ‘æˆ°ä»»å‹™
        const challengesData = [
            { id: 1, title: 'å¿«èµ°é”äºº', description: 'ä¸€é€±å…§å®Œæˆ 3 æ¬¡å¿«èµ°ï¼Œæ¯æ¬¡è‡³å°‘ 20 åˆ†é˜', reward: 100, current: 0, target: 3 },
            { id: 2, title: 'è¬æ­¥å‹‡å£«', description: 'é€£çºŒ 5 å¤©é”åˆ° 10,000 æ­¥', reward: 150, current: 0, target: 5 },
            { id: 3, title: 'æ°´åˆ†è£œçµ¦ç‹', description: 'é€£çºŒ 7 å¤©å–æ°´é‡é”åˆ° 2000ml', reward: 80, current: 0, target: 7 }
        ];

        // åœ˜éšŠè³‡æ–™
        const teamsData = [
            { 
                id: 1, 
                name: 'å¥åº·å°éšŠ', 
                members: ['å°æ˜', 'å°è¯', 'å°ç¾', 'å¥åº·é”äºº'],
                totalPoints: 3500,
                teamTask: 'åœ˜éšŠç´¯è¨ˆ 50,000 æ­¥',
                currentProgress: 35000,
                targetProgress: 50000
            }
        ];

        // ==================== ç‹€æ…‹ç®¡ç† ====================
        let userTotalPoints = 0;
        let unlockedBuildings = [];
        let userProgress = [];

        // ==================== åˆå§‹åŒ–åœ°åœ– ====================
        const NTUST_CENTER = [25.0132, 121.5418];
        const map = L.map('map').setView(NTUST_CENTER, 16);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // è‡ªè¨‚æ¨™è¨˜åœ–ç¤º
        const unlockedIcon = L.icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        const lockedIcon = L.icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        // ==================== é»æ•¸è¨ˆç®—é‚è¼¯ ====================
        function calculatePoints(steps, exercise, water) {
            let points = 0;
            
            // æ­¥æ•¸é»æ•¸ (æ¯1000æ­¥ = 10é»ï¼Œè¶…é10000æ­¥æœ‰é¡å¤–çå‹µ)
            points += Math.floor(steps / 1000) * 10;
            if (steps >= 10000) points += 50; // ç ´è¬çå‹µ
            if (steps >= 15000) points += 100; // è¶…ç´šçå‹µ
            
            // é‹å‹•æ™‚é–“é»æ•¸ (æ¯10åˆ†é˜ = 15é»ï¼Œè¶…é30åˆ†é˜æœ‰é¡å¤–çå‹µ)
            points += Math.floor(exercise / 10) * 15;
            if (exercise >= 30) points += 30;
            if (exercise >= 60) points += 80;
            
            // å–æ°´é‡é»æ•¸ (æ¯500ml = 5é»ï¼Œé”åˆ°2000mlæœ‰çå‹µ)
            points += Math.floor(water / 500) * 5;
            if (water >= 2000) points += 25;
            if (water >= 3000) points += 50;
            
            return points;
        }

        // ==================== å³æ™‚é è¦½é»æ•¸ ====================
        document.getElementById('steps').addEventListener('input', updatePreview);
        document.getElementById('exercise').addEventListener('input', updatePreview);
        document.getElementById('water').addEventListener('input', updatePreview);

        function updatePreview() {
            const steps = parseInt(document.getElementById('steps').value) || 0;
            const exercise = parseInt(document.getElementById('exercise').value) || 0;
            const water = parseInt(document.getElementById('water').value) || 0;
            
            const points = calculatePoints(steps, exercise, water);
            document.getElementById('previewPoints').textContent = points;
        }

        // ==================== æäº¤æ¯æ—¥æ•¸æ“š ====================
        document.getElementById('dailyForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const steps = parseInt(document.getElementById('steps').value);
            const exercise = parseInt(document.getElementById('exercise').value);
            const water = parseInt(document.getElementById('water').value);
            const points = calculatePoints(steps, exercise, water);
            
            // æ›´æ–°ç¸½é»æ•¸
            userTotalPoints += points;
            
            // æª¢æŸ¥æ˜¯å¦å¯ä»¥è§£é–æ–°å»ºç¯‰
            checkUnlockBuildings();
            
            // æ›´æ–°æŒ‘æˆ°é€²åº¦
            updateChallenges(steps, exercise, water);
            
            // é¡¯ç¤ºé€šçŸ¥
            showNotification(`ğŸ‰ å¤ªæ£’äº†ï¼ä»Šæ—¥ç²å¾— ${points} é»ï¼ç¸½é»æ•¸ï¼š${userTotalPoints}`);
            
            // é‡ç½®è¡¨å–®
            document.getElementById('dailyForm').reset();
            updatePreview();
            
            // æ›´æ–°é¡¯ç¤º
            updateUI();
            
            // å¯é¸ï¼šç™¼é€åˆ°å¾Œç«¯
            try {
                await fetch(`${API_URL}/upload_data`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: userId,
                        date: new Date().toISOString().split('T')[0],
                        steps, exercise_minutes: exercise, water_ml: water,
                        points_earned: points
                    })
                });
            } catch (error) {
                console.log('å¾Œç«¯æœªé€£æ¥ï¼Œä½¿ç”¨æœ¬åœ°è³‡æ–™');
            }
        });

        // ==================== æª¢æŸ¥å»ºç¯‰ç‰©è§£é– ====================
        function checkUnlockBuildings() {
            buildingsData.forEach(building => {
                if (!unlockedBuildings.includes(building.id) && userTotalPoints >= building.points) {
                    unlockedBuildings.push(building.id);
                    showNotification(`ğŸŠ æ­å–œè§£é–æ–°å»ºç¯‰ï¼š${building.name}ï¼`);
                }
            });
        }

        // ==================== æ›´æ–°æŒ‘æˆ°é€²åº¦ ====================
        function updateChallenges(steps, exercise, water) {
            // å¿«èµ°é”äºº
            if (exercise >= 20) {
                challengesData[0].current = Math.min(challengesData[0].current + 1, challengesData[0].target);
            }
            
            // è¬æ­¥å‹‡å£«
            if (steps >= 10000) {
                challengesData[1].current = Math.min(challengesData[1].current + 1, challengesData[1].target);
            }
            
            // æ°´åˆ†è£œçµ¦ç‹
            if (water >= 2000) {
                challengesData[2].current = Math.min(challengesData[2].current + 1, challengesData[2].target);
            }
            
            // æª¢æŸ¥æ˜¯å¦å®ŒæˆæŒ‘æˆ°
            challengesData.forEach(challenge => {
                if (challenge.current === challenge.target && !challenge.completed) {
                    challenge.completed = true;
                    userTotalPoints += challenge.reward;
                    showNotification(`ğŸ† å®ŒæˆæŒ‘æˆ°ã€Œ${challenge.title}ã€ï¼ç²å¾— ${challenge.reward} é»çå‹µï¼`);
                }
            });
        }

        // ==================== æ¸²æŸ“åœ°åœ–æ¨™è¨˜ ====================
        function renderMap() {
            buildingsData.forEach(building => {
                const isUnlocked = unlockedBuildings.includes(building.id);
                const icon = isUnlocked ? unlockedIcon : lockedIcon;
                
                const marker = L.marker([building.lat, building.lng], { icon })
                    .addTo(map)
                    .bindPopup(`
                        <div class="building-info">
                            <strong>${building.name}</strong><br/>
                            <p style="margin: 10px 0;">${building.description}</p>
                            <p>ğŸ¯ è§£é–é»æ•¸ï¼š${building.points}</p>
                            <span class="unlocked-badge ${isUnlocked ? 'unlocked' : 'locked'}">
                                ${isUnlocked ? 'âœ… å·²è§£é–' : 'ğŸ”’ æœªè§£é–'}
                            </span>
                        </div>
                    `);
            });
        }

        // ==================== æ¸²æŸ“æŒ‘æˆ°ä»»å‹™ ====================
        function renderChallenges() {
            const html = challengesData.map(challenge => {
                const progress = (challenge.current / challenge.target) * 100;
                return `
                    <div class="challenge-card">
                        <h3>${challenge.title}</h3>
                        <p>${challenge.description}</p>
                        <div class="challenge-progress">
                            <div class="challenge-progress-bar" style="width: ${progress}%"></div>
                        </div>
                        <p style="margin-top: 10px;">é€²åº¦ï¼š${challenge.current} / ${challenge.target}</p>
                        <p class="challenge-reward">ğŸ çå‹µï¼š${challenge.reward} é»</p>
                        ${challenge.completed ? '<p style="color: #28a745; font-weight: 600;">âœ… å·²å®Œæˆ</p>' : ''}
                    </div>
                `;
            }).join('');
            document.getElementById('challengesList').innerHTML = html;
        }

        // ==================== æ¸²æŸ“åœ˜éšŠ ====================
        function renderTeams() {
            const html = teamsData.map(team => {
                const progress = (team.currentProgress / team.targetProgress) * 100;
                return `
                    <div class="team-card">
                        <h3>ğŸ‘¥ ${team.name}</h3>
                        <div class="team-members">
                            ${team.members.map(m => `<span class="member-badge">${m}</span>`).join('')}
                        </div>
                        <div class="team-progress">
                            <strong>åœ˜éšŠä»»å‹™ï¼š${team.teamTask}</strong>
                            <div class="challenge-progress" style="margin: 10px 0;">
                                <div class="challenge-progress-bar" style="width: ${progress}%"></div>
                            </div>
                            <p>é€²åº¦ï¼š${team.currentProgress.toLocaleString()} / ${team.targetProgress.toLocaleString()}</p>
                        </div>
                        <div class="team-stats">
                            <div class="team-stat-item">
                                <strong>${team.totalPoints}</strong>
                                <span>åœ˜éšŠç¸½é»æ•¸</span>
                            </div>
                            <div class="team-stat-item">
                                <strong>${team.members.length}</strong>
                                <span>æˆå“¡æ•¸</span>
                            </div>
                            <div class="team-stat-item">
                                <strong>${Math.floor(progress)}%</strong>
                                <span>ä»»å‹™é€²åº¦</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            document.getElementById('teamSection').innerHTML = html;
        }

        // ==================== æ›´æ–° UI ====================
        function updateUI() {
            document.getElementById('totalPoints').textContent = userTotalPoints;
            document.getElementById('unlockedCount').textContent = `${unlockedBuildings.length} / ${buildingsData.length}`;
            renderChallenges();
            
            // é‡æ–°æ¸²æŸ“åœ°åœ–æ¨™è¨˜
            map.eachLayer(layer => {
                if (layer instanceof L.Marker) {
                    map.removeLayer(layer);
                }
            });
            renderMap();
        }

        // ==================== é€šçŸ¥ç³»çµ± ====================
        function showNotification(text) {
            const notification = document.getElementById('notification');
            document.getElementById('notificationText').textContent = text;
            notification.classList.add('show', 'success');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ==================== åˆå§‹åŒ– ====================
        window.addEventListener('load', () => {
            renderMap();
            renderChallenges();
            renderTeams();
            updateUI();
        });
    </script>
</body>
</html>